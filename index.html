<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å¯¶å¯¶é›†é»å¡ v2.0</title>
    <!-- æ‰‹å¯«å­—é«” -->
    <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@700&family=Zen+Maru+Gothic:wght@500;700&display=swap" rel="stylesheet">
    <!-- æ…¶ç¥ç‰¹æ•ˆ -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        :root {
            --paper-color: #fff9f0;
            --text-color: #4a4a4a;
            
            /* å¥½å¯¶å¯¶ä¸»é¡Œè‰² */
            --good-primary: #ff8fa3;
            --good-secondary: #fff0f3;
            --good-border: #ffccd5;

            /* å£å¯¶å¯¶ä¸»é¡Œè‰² */
            --bad-primary: #8ecae6;
            --bad-secondary: #f0f8ff;
            --bad-border: #bde0fe;
        }

        * {
            box-sizing: border-box;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: #f2e9e4;
            font-family: 'Zen Maru Gothic', sans-serif;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden; /* ç¦æ­¢é é¢æ²å‹• */
        }

        /* ----- ç™»å…¥ç•«é¢ ----- */
        #login-screen {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,249,240, 0.95);
            z-index: 999;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: opacity 0.5s;
        }
        
        .login-box {
            background: #fff;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            text-align: center;
            border: 3px dashed #ccc;
        }

        input[type="text"] {
            font-family: 'Zen Maru Gothic', sans-serif;
            padding: 10px;
            font-size: 1.2rem;
            border: 2px solid #ccc;
            border-radius: 10px;
            margin: 15px 0;
            width: 200px;
            text-align: center;
        }

        /* ----- ä¸»ä»‹é¢å®¹å™¨ ----- */
        .app-container {
            width: 100%;
            height: 100%;
            max-width: 450px; /* æ‰‹æ©Ÿæœ€å¤§å¯¬åº¦ */
            background-color: var(--paper-color);
            position: relative;
            display: flex;
            flex-direction: column;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }

        /* é ‚éƒ¨åˆ‡æ›é ç±¤ */
        .tabs {
            display: flex;
            height: 60px;
        }

        .tab {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .tab.active {
            font-size: 1.4rem;
        }

        /* å¥½å¯¶å¯¶é ç±¤æ¨£å¼ */
        .tab-good { background: #ffe5ec; color: #ff5c8a; }
        .tab-good.active { background: var(--good-primary); color: white; }

        /* å£å¯¶å¯¶é ç±¤æ¨£å¼ */
        .tab-bad { background: #e0fbfc; color: #219ebc; }
        .tab-bad.active { background: var(--bad-primary); color: white; }

        /* å¡ç‰‡å…§å®¹å€ */
        .content-area {
            flex: 1;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background-image: radial-gradient(#ddd 1px, transparent 1px);
            background-size: 20px 20px;
            position: relative;
        }

        .header-info {
            text-align: center;
            margin-bottom: 20px;
        }

        h1 {
            font-family: 'Caveat', cursive;
            margin: 0;
            font-size: 3rem;
            transform: rotate(-3deg);
            color: var(--text-color);
        }

        .subtitle {
            margin-top: 5px;
            color: #888;
            font-size: 1rem;
        }

        /* 10æ ¼é›†é»å€ */
        .grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            width: 100%;
            max-width: 320px;
        }

        .slot {
            aspect-ratio: 1/1;
            background: rgba(255,255,255,0.8);
            border: 2px dashed #bbb;
            border-radius: 50% 45% 55% 40% / 40% 55% 45% 60%; /* æ‰‹ç¹ªä¸è¦å‰‡åœ“ */
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5rem;
            color: #ddd;
            cursor: pointer;
            position: relative;
            transition: transform 0.2s;
        }

        .slot:active { transform: scale(0.95); }

        /* å°ç« æœ¬é«” */
        .stamp {
            position: absolute;
            width: 90%;
            height: 90%;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'Caveat', cursive;
            font-weight: bold;
            font-size: 1.4rem;
            opacity: 0;
            transform: scale(2) rotate(var(--r));
            transition: all 0.4s cubic-bezier(0.25, 1, 0.5, 1);
            mask-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.7' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.6'/%3E%3C/svg%3E");
            -webkit-mask-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.7' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.6'/%3E%3C/svg%3E");
        }

        /* è“‹ç« ç‹€æ…‹ (å¥½å¯¶å¯¶) */
        .mode-good .slot.stamped { border-color: var(--good-border); }
        .mode-good .stamp {
            border: 3px solid var(--good-primary);
            color: var(--good-primary);
        }

        /* è“‹ç« ç‹€æ…‹ (å£å¯¶å¯¶) */
        .mode-bad .slot.stamped { border-color: var(--bad-border); }
        .mode-bad .stamp {
            border: 3px solid var(--bad-primary);
            color: var(--bad-primary);
        }

        .slot.stamped .stamp {
            opacity: 0.9;
            transform: scale(1) rotate(var(--r));
        }

        /* åº•éƒ¨é€²åº¦æ¢ */
        .footer {
            padding: 15px;
            text-align: center;
            background: rgba(255,255,255,0.5);
            border-top: 1px dashed #ccc;
        }

        .progress-text { font-size: 1.2rem; font-weight: bold; color: var(--text-color); }

        /* é€šç”¨æŒ‰éˆ• */
        .btn {
            padding: 10px 25px;
            border: none;
            border-radius: 30px;
            font-family: 'Zen Maru Gothic', sans-serif;
            font-weight: bold;
            font-size: 1rem;
            cursor: pointer;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.1);
            transition: transform 0.1s;
        }
        .btn:active { transform: scale(0.95); }
        .btn-primary { background: #333; color: #fff; }

        /* å½ˆå‡ºè¦–çª— (Modal) */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .modal {
            background: #fff;
            width: 85%;
            max-width: 320px;
            padding: 25px;
            border-radius: 20px;
            text-align: center;
            animation: popIn 0.3s ease;
            position: relative;
        }

        @keyframes popIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .modal textarea {
            width: 100%;
            height: 80px;
            margin: 15px 0;
            padding: 10px;
            border: 2px solid #eee;
            border-radius: 10px;
            font-family: 'Zen Maru Gothic', sans-serif;
            resize: none;
        }

        .modal-title { font-size: 1.3rem; margin-bottom: 10px; font-weight: bold; }
        .modal-buttons { display: flex; justify-content: space-around; gap: 10px; }
        
        .btn-cancel { background: #eee; color: #666; }
        .btn-confirm { background: var(--good-primary); color: white; }
        .btn-delete { background: #ff4d4d; color: white; }

        /* ä¸åŒæ¨¡å¼ä¸‹çš„ç¢ºèªæŒ‰éˆ•é¡è‰² */
        .mode-bad .btn-confirm { background: var(--bad-primary); }

        /* åª’é«”æŸ¥è©¢å„ªåŒ– */
        @media (min-height: 700px) {
            .grid { grid-template-columns: repeat(2, 1fr); gap: 25px; }
        }
        /* å¦‚æœè¢å¹•å¾ˆå¯¬ï¼Œæ”¹5æ¬„ */
        @media (min-width: 600px) {
            .grid { grid-template-columns: repeat(5, 1fr); }
            .app-container { max-width: 600px; height: auto; border-radius: 20px; margin: 20px; min-height: 80vh; }
        }
    </style>
</head>
<body>

    <!-- ç™»å…¥ç•«é¢ -->
    <div id="login-screen">
        <div class="login-box">
            <h1 style="font-size: 2rem;">Who are you?</h1>
            <p>è«‹è¼¸å…¥å¯¶å¯¶çš„åå­—</p>
            <input type="text" id="nameInput" placeholder="ä¾‹å¦‚: è±¬è±¬å¯¶è²" maxlength="10">
            <br>
            <button class="btn btn-primary" onclick="login()">é–‹å§‹é›†é»</button>
        </div>
    </div>

    <!-- ä¸»ç¨‹å¼ -->
    <div class="app-container mode-good" id="appContainer">
        <!-- é ç±¤ -->
        <div class="tabs">
            <div class="tab tab-good active" onclick="switchTab('good')">å¥½å¯¶å¯¶ â¤ï¸</div>
            <div class="tab tab-bad" onclick="switchTab('bad')">å£å¯¶å¯¶ ğŸŒ©ï¸</div>
        </div>

        <!-- å…§å®¹å€ -->
        <div class="content-area">
            <div class="header-info">
                <h1 id="cardTitle">Good Baby</h1>
                <p class="subtitle"><span id="displayName">å¯¶å¯¶</span> çš„é›†é»å¡</p>
            </div>

            <div class="grid" id="stampGrid">
                <!-- JS ç”¢ç”Ÿæ ¼å­ -->
            </div>
        </div>

        <!-- åº•éƒ¨ -->
        <div class="footer">
            <div class="progress-text">
                é€²åº¦: <span id="currentScore">0</span> / 10
            </div>
            <div style="font-size: 0.8rem; color: #aaa; margin-top: 5px;">é›†æ»¿10é»å¯å…Œæ›çå‹µ</div>
        </div>
    </div>

    <!-- è¼¸å…¥/æŸ¥çœ‹ç†ç”± Modal -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal">
            <div class="modal-title" id="modalTitle">ç²å¾—ä¸€é»</div>
            <p id="modalDate" style="font-size: 0.8rem; color: #999; margin-bottom: 5px;"></p>
            
            <!-- è¼¸å…¥æ¨¡å¼é¡¯ç¤º textarea, æŸ¥çœ‹æ¨¡å¼é¡¯ç¤º p -->
            <textarea id="reasonInput" placeholder="è«‹è¼¸å…¥ç†ç”±... (ä¾‹å¦‚: ä¸»å‹•åšå®¶äº‹)"></textarea>
            <p id="reasonText" style="display:none; font-size: 1.1rem; color: #555; background: #f9f9f9; padding: 10px; border-radius: 10px;"></p>

            <div class="modal-buttons" id="inputButtons">
                <button class="btn btn-cancel" onclick="closeModal()">å–æ¶ˆ</button>
                <button class="btn btn-confirm" onclick="confirmStamp()">è“‹ç« !</button>
            </div>

            <div class="modal-buttons" id="viewButtons" style="display:none;">
                <button class="btn btn-cancel" onclick="closeModal()">é—œé–‰</button>
                <button class="btn btn-delete" onclick="deleteStamp()">æ’¤éŠ·æ­¤é»</button>
            </div>
        </div>
    </div>

    <script>
        // è³‡æ–™çµæ§‹
        const TOTAL_POINTS = 10;
        let appData = {
            name: "",
            goodPoints: [], // å­˜æ”¾ç‰©ä»¶: { reason: "", date: "" }
            badPoints: []
        };
        
        let currentTab = 'good'; // 'good' or 'bad'
        let selectedSlotIndex = -1; // æ­£åœ¨æ“ä½œå“ªä¸€æ ¼

        // DOM å…ƒç´ 
        const loginScreen = document.getElementById('login-screen');
        const appContainer = document.getElementById('appContainer');
        const displayName = document.getElementById('displayName');
        const stampGrid = document.getElementById('stampGrid');
        const currentScore = document.getElementById('currentScore');
        const cardTitle = document.getElementById('cardTitle');
        const nameInput = document.getElementById('nameInput');

        // Modal ç›¸é—œå…ƒç´ 
        const modalOverlay = document.getElementById('modalOverlay');
        const modalTitle = document.getElementById('modalTitle');
        const reasonInput = document.getElementById('reasonInput');
        const reasonText = document.getElementById('reasonText');
        const inputButtons = document.getElementById('inputButtons');
        const viewButtons = document.getElementById('viewButtons');
        const modalDate = document.getElementById('modalDate');

        // åˆå§‹åŒ–
        function init() {
            const savedData = localStorage.getItem('baby_card_data_v2');
            if (savedData) {
                appData = JSON.parse(savedData);
                if (appData.name) {
                    enterApp();
                }
            }
        }

        // ç™»å…¥
        function login() {
            const name = nameInput.value.trim();
            if (!name) return alert("è«‹è¼¸å…¥åå­—å”·ï¼");
            appData.name = name;
            saveData();
            enterApp();
        }

        function enterApp() {
            loginScreen.style.opacity = 0;
            setTimeout(() => {
                loginScreen.style.display = 'none';
            }, 500);
            displayName.innerText = appData.name;
            renderGrid();
        }

        // åˆ‡æ›é ç±¤
        function switchTab(tab) {
            currentTab = tab;
            
            // æ›´æ–° UI æ¨£å¼
            appContainer.className = `app-container mode-${tab}`;
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelector(`.tab-${tab}`).classList.add('active');

            cardTitle.innerText = tab === 'good' ? 'Good Baby' : 'Bad Baby';
            renderGrid();
        }

        // æ¸²æŸ“æ ¼å­
        function renderGrid() {
            stampGrid.innerHTML = '';
            const points = currentTab === 'good' ? appData.goodPoints : appData.badPoints;
            currentScore.innerText = points.length;

            for (let i = 0; i < TOTAL_POINTS; i++) {
                const slot = document.createElement('div');
                slot.className = 'slot';
                
                // ç”¢ç”Ÿéš¨æ©Ÿæ—‹è½‰è§’åº¦ CSS è®Šæ•¸
                const rotate = Math.floor(Math.random() * 60) - 30;
                slot.style.setProperty('--r', `${rotate}deg`);

                if (i < points.length) {
                    // å·²è“‹ç« 
                    slot.classList.add('stamped');
                    const stampType = currentTab === 'good' ? 'Good' : 'Bad';
                    slot.innerHTML = `<div class="stamp">${stampType}</div>`;
                    slot.onclick = () => viewReason(i); // é»æ“ŠæŸ¥çœ‹ç†ç”±
                } else if (i === points.length) {
                    // ä¸‹ä¸€å€‹ç©ºæ ¼ (å¯è“‹ç« )
                    slot.onclick = () => openStampModal();
                    slot.style.border = "2px dashed #888"; // æç¤ºé€™è£¡æ˜¯ä¸‹ä¸€æ ¼
                }

                stampGrid.appendChild(slot);
            }

            // æª¢æŸ¥æ˜¯å¦é›†æ»¿
            if (points.length === TOTAL_POINTS) {
                // é€™è£¡å¯ä»¥åŠ ä¸€é»ç‰¹æ•ˆï¼Œé¿å…æ¯æ¬¡æ¸²æŸ“éƒ½è·‘
            }
        }

        // --- Modal é‚è¼¯ ---

        // é–‹å•Ÿè“‹ç« è¦–çª—
        function openStampModal() {
            selectedSlotIndex = -1; // -1 ä»£è¡¨æ–°å¢æ¨¡å¼
            modalOverlay.style.display = 'flex';
            
            modalTitle.innerText = currentTab === 'good' ? 'çµ¦å¥½å¯¶å¯¶è“‹å€‹ç« ' : 'å–”å–”...å£å¯¶å¯¶å—ï¼Ÿ';
            reasonInput.style.display = 'block';
            reasonInput.value = '';
            reasonText.style.display = 'none';
            inputButtons.style.display = 'flex';
            viewButtons.style.display = 'none';
            modalDate.innerText = new Date().toLocaleDateString();
        }

        // é–‹å•ŸæŸ¥çœ‹ç†ç”±è¦–çª—
        function viewReason(index) {
            selectedSlotIndex = index;
            const points = currentTab === 'good' ? appData.goodPoints : appData.badPoints;
            const data = points[index];

            modalOverlay.style.display = 'flex';
            modalTitle.innerText = `ç¬¬ ${index + 1} é»çš„ç†ç”±`;
            
            reasonInput.style.display = 'none';
            reasonText.style.display = 'block';
            reasonText.innerText = data.reason || "æ²’æœ‰å¡«å¯«ç†ç”±";
            modalDate.innerText = data.date;

            inputButtons.style.display = 'none';
            viewButtons.style.display = 'flex';
        }

        function closeModal() {
            modalOverlay.style.display = 'none';
        }

        // ç¢ºèªè“‹ç« 
        function confirmStamp() {
            const reason = reasonInput.value.trim();
            if (!reason && !confirm("ç¢ºå®šä¸å¯«ç†ç”±ç›´æ¥è“‹ç« å—ï¼Ÿ")) return;

            const newPoint = {
                reason: reason || "ç§˜å¯†",
                date: new Date().toLocaleDateString() + " " + new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})
            };

            if (currentTab === 'good') {
                appData.goodPoints.push(newPoint);
                triggerConfetti();
            } else {
                appData.badPoints.push(newPoint);
            }

            saveData();
            renderGrid();
            closeModal();

            if (appData[currentTab === 'good' ? 'goodPoints' : 'badPoints'].length === TOTAL_POINTS) {
                setTimeout(() => alert("æ­å–œé›†æ»¿ 10 é»ï¼å¿«å»å…Œæ›çå‹µï¼"), 500);
            }
        }

        // åˆªé™¤å°ç« 
        function deleteStamp() {
            if (!confirm("ç¢ºå®šè¦æ’¤éŠ·é€™ä¸€é»å—ï¼Ÿ")) return;

            const points = currentTab === 'good' ? appData.goodPoints : appData.badPoints;
            // åˆªé™¤é‚è¼¯ï¼šé›–ç„¶é»é¸ç‰¹å®šæ ¼å­ï¼Œä½†é€šå¸¸é›†é»å¡æ˜¯å¾æœ€å¾Œé¢é–‹å§‹åˆª
            // ç‚ºäº†ç°¡å–®é‚è¼¯ï¼Œæˆ‘å€‘åˆªé™¤è©²ç­†è³‡æ–™ï¼Œä¸¦é‡æ–°æ¸²æŸ“
            
            // é€²éšé‚è¼¯ï¼šå¦‚æœè¦åˆªé™¤ä¸­é–“çš„é»ï¼Œé€šå¸¸æœƒæŠŠå¾Œé¢çš„å¾€å‰ç§»
            points.splice(selectedSlotIndex, 1);
            
            saveData();
            renderGrid();
            closeModal();
        }

        // å„²å­˜è³‡æ–™
        function saveData() {
            localStorage.setItem('baby_card_data_v2', JSON.stringify(appData));
        }

        // æ…¶ç¥ç‰¹æ•ˆ
        function triggerConfetti() {
            const colors = currentTab === 'good' ? ['#ff8fa3', '#fff0f3'] : ['#8ecae6', '#219ebc'];
            confetti({
                particleCount: 100,
                spread: 70,
                origin: { y: 0.6 },
                colors: colors
            });
        }

        // å•Ÿå‹• App
        init();

    </script>
</body>
</html>